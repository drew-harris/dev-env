#!/bin/bash

# Check if both arguments are provided
if [ "$#" -ne 2 ]; then
    echo "Usage: $0 <window_class> <program_name>"
    exit 1
fi

# Assign arguments to variables
WINDOW_CLASS="$1"
PROGRAM_NAME="$2"

# Get the list of clients in JSON format
CLIENTS=$(hyprctl clients -j)

# Use jq to reverse the array and find the address of the FIRST window with the specified class
# By reversing, 'first' will output the address of the window that appeared latest in the original list,
# which should be the main window if it opened before the PiP window.
WINDOW_ADDRESS=$(echo "$CLIENTS" | jq -r --arg class "$WINDOW_CLASS" 'reverse[] | select(.class == $class) | .address' | head -n 1)


if [ -n "$WINDOW_ADDRESS" ]; then
    # Window found, focus it
    echo "Window with class $WINDOW_CLASS found at address $WINDOW_ADDRESS. Focusing..."
    hyprctl dispatch focuswindow address:"$WINDOW_ADDRESS"
else
    # Window not found
    echo "Window with class $WINDOW_CLASS not found. Launching $PROGRAM_NAME..."
    $PROGRAM_NAME &
fi

